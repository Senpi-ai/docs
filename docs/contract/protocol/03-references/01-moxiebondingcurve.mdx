---
description: Learn all the functions, events, errors, and roles of the MoxieBondingCurve.sol contract.
---

# MoxieBondingCurve.sol

Bonding curve contract which enables subject onboarding, buy & sell of subject shares.

## Functions

### updateFees

Update fee only be called by role UPDATE_FEES_ROLE.

```js
function updateFees(
    FeeInput memory _feeInput
) external onlyRole(UPDATE_FEES_ROLE) {}
```

#### Parameters

| Name        | Type     | Description      |
| :---------- | :------- | :--------------- |
| `_feeInput` | FeeInput | Feeinput struct. |

### updateFormula

Update formula to `_formula`. It can be done by UPDATE_FORMULA_ROLE.

```js
function updateFormula(
    address _formula
) external onlyRole(UPDATE_FORMULA_ROLE) {}
```

#### Parameters

| Name       | Type    | Description                                                 |
| :--------- | :------ | :---------------------------------------------------------- |
| `_formula` | address | The address of the new BancorFormula [computation] contract |

### updateFeeBeneficiary

Update beneficiary to `\_beneficiary. It can be done by UPDATE_BENEFICIARY_ROLE.

```js
function updateFeeBeneficiary(
    address _feeBeneficiary
) external onlyRole(UPDATE_BENEFICIARY_ROLE) {}
```

#### Parameters

| Name              | Type    | Description                                                      |
| :---------------- | :------ | :--------------------------------------------------------------- |
| `_feeBeneficiary` | address | The address of the new beneficiary [to whom fees are to be sent] |

### initializeSubjectBondingCurve

Initialize Bonding curve for subject, it's called by subject factory.

```js
function initializeSubjectBondingCurve(
  address _subject,
  uint32 _reserveRatio,
  uint256 _initialSupply,
  uint256 _reserveAmount
) external whenNotPaused returns (bool) {}
```

#### Parameters

| Name             | Type    | Description                                                                   |
| :--------------- | :------ | :---------------------------------------------------------------------------- |
| `_subject`       | address | Address of subject.                                                           |
| `_reserveRatio`  | uint32  | Initial supply of subject tokens at the time of bonding curve initialization. |
| `_initialSupply` | uint256 | reserve ratio of subject for bonding curve.                                   |
| `_reserveAmount` | uint256 | Initial reserve amount.                                                       |

#### Return Value

| Name            | Type | Description                                                 |
| :-------------- | :--- | :---------------------------------------------------------- |
| `isInitialized` | bool | `true` if bonding curve is initialized. Otherwise, `false`. |

### buySharesFor

Buy shares of a subject on behalf of a beneficiary.

```js
function buySharesFor(
    address _subject,
    uint256 _depositAmount,
    address _onBehalfOf,
    uint256 _minReturnAmountAfterFee
) external whenNotPaused returns (uint256 shares_) {}
```

#### Parameters

| Name                       | Type    | Description                                     |
| :------------------------- | :------ | :---------------------------------------------- |
| `_subject`                 | address | Address of subject.                             |
| `_depositAmount`           | uint256 | Amount of deposit to buy shares.                |
| `_onBehalfOf`              | address | Address of beneficiary.                         |
| `_minReturnAmountAfterFee` | uint256 | Minimum number of shares that must be received. |

#### Return Value

| Name      | Type    | Description       |
| :-------- | :------ | :---------------- |
| `shares_` | uint256 | Number of shares. |

### buyShares

Buy shares of a subject.

```js
function buyShares(
    address _subject,
    uint256 _depositAmount,
    uint256 _minReturnAmountAfterFee
) external whenNotPaused returns (uint256 shares_) {}
```

#### Parameters

| Name                       | Type    | Description                                     |
| :------------------------- | :------ | :---------------------------------------------- |
| `_subject`                 | address | Address of subject.                             |
| `_depositAmount`           | uint256 | Amount of deposit to buy shares.                |
| `_minReturnAmountAfterFee` | uint256 | Minimum number of shares that must be received. |

#### Return Value

| Name      | Type    | Description       |
| :-------- | :------ | :---------------- |
| `shares_` | uint256 | Number of shares. |

### sellSharesFor

Sell shares of a subject on behalf of a beneficiary.

```js
function sellSharesFor(
    address _subject,
    uint256 _sellAmount,
    address _onBehalfOf,
    uint256 _minReturnAmountAfterFee
) external whenNotPaused returns (uint256 returnAmount_) {}
```

#### Parameters

| Name                       | Type    | Description                                     |
| :------------------------- | :------ | :---------------------------------------------- |
| `_subject`                 | address | Address of subject.                             |
| `_sellAmount`              | uint256 | Amount of subject shares to sell.               |
| `_onBehalfOf`              | address | Address of buy token beneficiary.               |
| `_minReturnAmountAfterFee` | uint256 | Minimum number of shares that must be received. |

#### Return Value

| Name            | Type    | Description                                           |
| :-------------- | :------ | :---------------------------------------------------- |
| `returnAmount_` | uint256 | Amount received in MOXIE from selling subject shares. |

### sellShares

Sell shares of a subject.

```js
function sellShares(
    address _subject,
    uint256 _sellAmount,
    uint256 _minReturnAmountAfterFee
) external whenNotPaused returns (uint256 returnAmount_) {}
```

#### Parameters

| Name                       | Type    | Description                                     |
| :------------------------- | :------ | :---------------------------------------------- |
| `_subject`                 | address | Address of subject.                             |
| `_sellAmount`              | uint256 | Amount of subject shares to sell.               |
| `_minReturnAmountAfterFee` | uint256 | Minimum number of shares that must be received. |

#### Return Value

| Name            | Type    | Description                                           |
| :-------------- | :------ | :---------------------------------------------------- |
| `returnAmount_` | uint256 | Amount received in MOXIE from selling subject shares. |

## Events

### UpdateFees

```js
event UpdateFees(
  uint256 _protocolBuyFeePct,
  uint256 _protocolSellFeePct,
  uint256 _subjectBuyFeePct,
  uint256 _subjectSellFeePct
);
```

### UpdateBeneficiary

```js
event UpdateBeneficiary(address _beneficiary);
```

### UpdateFormula

```js
event UpdateFormula(address _formula);
```

### BondingCurveInitialized

```js
event BondingCurveInitialized(
  address _subject,
  address _subjectToken,
  uint256 _initialSupply,
  uint256 _reserve,
  uint32 _reserveRatio
);
```

### SubjectSharePurchased

```js
event SubjectSharePurchased(
  address _subject,
  address _sellToken,
  uint256 _sellAmount,
  address _buyToken,
  uint256 _buyAmount,
  address _beneficiary
);
```

### SubjectShareSold

```js
event SubjectShareSold(
    address \_subject,
    address \_sellToken,
    uint256 \_sellAmount,
    address \_buyToken,
    uint256 \_buyAmount,
    address \_beneficiary
);
```

## Errors

### MoxieBondingCurve_InvalidToken

```js
error MoxieBondingCurve_InvalidToken();
```

### MoxieBondingCurve_InvalidVault

```js
error MoxieBondingCurve_InvalidVault();
```

### MoxieBondingCurve_InvalidBeneficiary

```js
error MoxieBondingCurve_InvalidBeneficiary();
```

### MoxieBondingCurve_InvalidFeePercentage

```js
error MoxieBondingCurve_InvalidFeePercentage();
```

### MoxieBondingCurve_InvalidFormula

```js
error MoxieBondingCurve_InvalidFormula();
```

### MoxieBondingCurve_InvalidTokenManager

```js
error MoxieBondingCurve_InvalidTokenManager();
```

### MoxieBondingCurve_InvalidOwner

```js
error MoxieBondingCurve_InvalidOwner();
```

### MoxieBondingCurve_InvalidSubjectFactory

```js
error MoxieBondingCurve_InvalidSubjectFactory();
```

### MoxieBondingCurve_OnlySubjectFactory

```js
error MoxieBondingCurve_OnlySubjectFactory();
```

### MoxieBondingCurve_InvalidReserveRation

```js
error MoxieBondingCurve_InvalidReserveRation();
```

### MoxieBondingCurve_SubjectAlreadyInitialized

```js
error MoxieBondingCurve_SubjectAlreadyInitialized();
```

### MoxieBondingCurve_SubjectNotInitialized

```js
error MoxieBondingCurve_SubjectNotInitialized();
```

### MoxieBondingCurve_InvalidSubjectSupply

```js
error MoxieBondingCurve_InvalidSubjectSupply();
```

### MoxieBondingCurve_InvalidSubject

```js
error MoxieBondingCurve_InvalidSubject();
```

### MoxieBondingCurve_InvalidDepositAmount

```js
error MoxieBondingCurve_InvalidDepositAmount();
```

### MoxieBondingCurve_InvalidSubjectToken

```js
error MoxieBondingCurve_InvalidSubjectToken();
```

### MoxieBondingCurve_SlippageExceedsLimit

```js
error MoxieBondingCurve_SlippageExceedsLimit();
```

### MoxieBondingCurve_InvalidSellAmount

```js
error MoxieBondingCurve_InvalidSellAmount();
```
