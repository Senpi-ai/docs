---
description: Learn all the functions, events, errors, and roles of the SubjectFactory.sol contract.
---

# SubjectFactory.sol

## Functions

# initialize

Initialize the contract.

```js
function initialize(
    address _owner,
    address _tokenManager,
    address _moxieBondingCurve,
    address _token,
    address _easyAuction,
    FeeInput memory _feeInput,
    address _feeBeneficiary,
    uint256 _auctionDuration,
    uint256 _auctionOrderCancellationDuration
) external initializer {}
```

#### Parameters

| Name                                | Type    | Description                                              |
| :---------------------------------- | :------ | :------------------------------------------------------- |
| `_owner`                            | address | Owner of the contract.                                   |
| `_tokenManager`                     | address | Address of token manager contract.                       |
| `_moxieBondingCurve`                | address | Address of Bonding curve contract.                       |
| `_token`                            | address | Address of moxie token.                                  |
| `_easyAuction`                      | address | Address of Easy auction contract.                        |
| `_feeInput`                         | struct  | Fee input struct.                                        |
| `_feeBeneficiary`                   | address | Protocol fee beneficiary.                                |
| `_auctionDuration`                  | uint256 | Duration of auction in unixtimestamp.                    |
| `_auctionOrderCancellationDuration` | uint256 | Duration of auction order cancellation in unixtimestamp. |

### \_feeIsValid

check if fee is valid.

```js
function _feeIsValid(uint256 _fee) internal pure returns (bool) {}
```

#### Parameters

| Name   | Type    | Description                |
| :----- | :------ | :------------------------- |
| `_fee` | uint256 | Fee percentage in PCT_BASE |

#### Return Values

| Name      | Type | Description                                    |
| :-------- | :--- | :--------------------------------------------- |
| `isValid` | bool | Boolean indicating \_fee is less than PCT_BASE |

### \_feeBeneficiaryIsValid

Check if the fee beneficiary is valid.

```js
function _feeBeneficiaryIsValid(
    address _beneficiary
) internal pure returns (bool) {}
```

#### Parameters

| Name           | Type    | Description                |
| :------------- | :------ | :------------------------- |
| `_beneficiary` | address | Address of fee beneficiary |

#### Return Values

| Name      | Type | Description                                                         |
| :-------- | :--- | :------------------------------------------------------------------ |
| `isValid` | bool | Boolean indicating if the beneficiary address is not a null address |

### \_updateFeeBeneficiary

update fee beneficiary

```js
function _updateFeeBeneficiary(address _beneficiary) internal {}
```

#### Parameters

| Name           | Type    | Description                |
| :------------- | :------ | :------------------------- |
| `_beneficiary` | address | Address of fee beneficiary |

### \_updateFees

Update fee params

```js
function _updateFees(
    uint256 _protocolFeePct,
    uint256 _subjectFeePct
) internal {}
```

#### Parameters

| Name              | Type    | Description          |
| :---------------- | :------ | :------------------- |
| `_protocolFeePct` | uint256 | Protocol fee in PCT. |
| `_subjectFeePct`  | uint256 | Subject fee in PCT.  |

### \_updateAuctionTime

Create an auction for a subject.

```js
function _createAuction(
    address _subject,
    address _subjectToken,
    SubjectAuctionInput memory _auctionInput
) internal returns (uint256 auctionId_, uint256 auctionEndDate_) {}
```

#### Parameters

| Name            | Type    | Description                        |
| :-------------- | :------ | :--------------------------------- |
| `_subject`      | address | Address of subject.                |
| `_subjectToken` | address | Address of subject token.          |
| `_auctionInput` | struct  | Input params for auction creation. |

#### Return Values

| Name              | Type    | Description                        |
| :---------------- | :------ | :--------------------------------- |
| `auctionId_`      | uint256 | Auction Id.                        |
| `auctionEndDate_` | uint256 | Auction end date in unixtimestamp. |

### \_decodeOrder

Decode the clearing order from the auction.

```js
function _decodeOrder(
    bytes32 _orderData
)
    internal
    pure
    returns (uint64 userId, uint96 buyAmount, uint96 sellAmount)
{}
```

#### Parameters

| Name         | Type    | Description                       |
| :----------- | :------ | :-------------------------------- |
| `_orderData` | bytes32 | Order data from auction contract. |

#### Return Values

| Name         | Type   | Description                  |
| :----------- | :----- | :--------------------------- |
| `userId`     | uint64 | User Id in auction contract. |
| `buyAmount`  | uint96 | Amount of Moxie token.       |
| `sellAmount` | uint96 | Amount of Subject Token.     |

### \_closeAuction

Close auction & burn tokens which are not sold in auction.

```js
function _closeAuction(
    uint256 _auctionId,
    address _subject,
    uint256 _initialSupply
)
    internal
    returns (
        uint256 soldSupply_,
        uint256 amountRaised_,
        bytes32 clearingOrder
    )
{}
```

#### Parameters

| Name             | Type    | Description                      |
| :--------------- | :------ | :------------------------------- |
| `_auctionId`     | uint256 | Auction Id.                      |
| `_subject`       | address | Address of subject.              |
| `_initialSupply` | uint256 | Initial supply of subject token. |

#### Return Values

| Name            | Type    | Description                   |
| :-------------- | :------ | :---------------------------- |
| `soldSupply_`   | uint256 | Total supply sold in auction. |
| `amountRaised_` | uint256 | Amount raised in auction.     |
| `clearingOrder` | bytes32 | Clearing order from auction.  |

### \_calculateFee

Internal function to calculate fees.

```js
function _calculateFee(
    uint256 _amount
) internal view returns (uint256 protocolFee_, uint256 subjectFee_) {}
```

#### Parameters

| Name      | Type    | Description                              |
| :-------- | :------ | :--------------------------------------- |
| `_amount` | uint256 | Amount against fee should be calculated. |

#### Return Values

| Name           | Type    | Description               |
| :------------- | :------ | :------------------------ |
| `protocolFee_` | uint256 | Protocol fee in PCT_BASE. |
| `subjectFee_`  | uint256 | Subject fee in PCT_BASE.  |

### \_calculateTokensMintAfterAuction

Calculate tokens to mint for a given input amount based on the auction price.

```js
function _calculateTokensMintAfterAuction(
    bytes32 _clearingOrder,
    uint256 _amount
) internal pure returns (uint256) {}
```

#### Parameters

| Name             | Type    | Description                               |
| :--------------- | :------ | :---------------------------------------- |
| `_clearingOrder` | bytes32 | Clearing order from auction.              |
| `_amount`        | uint256 | Amount of reserve tokens from onboarding. |

#### Return Values

| Name    | Type    | Description                                                                     |
| :------ | :------ | :------------------------------------------------------------------------------ |
| `mint_` | uint256 | Amount of subject/fan tokens to mint after auction based on the clearing price. |

### \_initializeBondingCurve

Initialize the Bonding curve, also mint bonding supply for onboarding reserve amount.

```js
function _initializeBondingCurve(
    uint256 _auctionId,
    address _subject,
    uint256 _amountRaised,
    uint256 _supply,
    uint32 _reserveRatio,
    bytes32 _clearningOrder,
    uint256 _buyAmount
) internal {}
```

#### Parameters

| Name              | Type    | Description                             |
| :---------------- | :------ | :-------------------------------------- |
| `_auctionId`      | uint256 | Auction Id from easy auction contract.  |
| `_subject`        | address | Address of subject.                     |
| `_amountRaised`   | uint256 | Amount raised in auction.               |
| `_supply`         | uint256 | Total supply sold in auction.           |
| `_reserveRatio`   | uint32  | Reserve ratio for Bonding curve.        |
| `_clearningOrder` | bytes32 | Clearing order from auction.            |
| `_buyAmount`      | uint256 | Amount to mint shares to this contract. |

### \_updateAuctionTime

Function to onboard & start auction of initial supply of subject.

```js
/**
 * @dev
 * @param _subject Address of subject.
 * @param _auctionInput Input for auction creation.
 */
function initiateSubjectOnboarding(
    address _subject,
    SubjectAuctionInput memory _auctionInput
) external whenNotPaused onlyRole(ONBOARDING_ROLE) returns (uint256) {}
```

#### Parameters

| Name            | Type    | Description                        |
| :-------------- | :------ | :--------------------------------- |
| `_subject`      | address | Address of subject.                |
| `_auctionInput` | struct  | Input params for auction creation. |

#### Return Values

| Name        | Type    | Description                                    |
| :---------- | :------ | :--------------------------------------------- |
| `auctionId` | uint256 | Auction Id of the initialized subject auction. |

### \_finalizeSubjectOnboarding

Finalize subject onboarding.

1.  Close auction
1.  Burn unsold supply
1.  Calculate additional mint for onboarding reserve
1.  Calculate & transfer fee.
1.  Initiate bonding curve.

```js
function finalizeSubjectOnboarding(
    address _subject,
    uint256 _buyAmount,
    uint32 _reserveRatio
) external whenNotPaused onlyRole(ONBOARDING_ROLE) {}
```

#### Parameters

| Name            | Type    | Description                                                                |
| :-------------- | :------ | :------------------------------------------------------------------------- |
| `_subject`      | address | Address of subject token.                                                  |
| `_buyAmount`    | uint256 | Amount of tokens contract will be used to buy shares of the subject token. |
| `_reserveRatio` | uint32  | Reserve ratio of bonding curve.                                            |

### \_updateAuctionTime

Update beneficiary to `\_beneficiary. It can be done by UPDATE_BENEFICIARY_ROLE.

```js
function updateFeeBeneficiary(
    address _feeBeneficiary
) external onlyRole(UPDATE_BENEFICIARY_ROLE) {}
```

#### Parameters

| Name              | Type    | Description                                                      |
| :---------------- | :------ | :--------------------------------------------------------------- |
| `_feeBeneficiary` | address | The address of the new beneficiary [to whom fees are to be sent] |

### \_updateFees

Update fee only be called by role UPDATE_FEES_ROLE.

```js
function updateFees(
    FeeInput memory _feeInput
) external onlyRole(UPDATE_FEES_ROLE) {}
```

#### Parameters

| Name        | Type   | Description |
| :---------- | :----- | :---------- |
| `_feeInput` | struct | Fee input.  |

### \_updateAuctionTime

Update auction parameters.

```js
function updateAuctionTime(
    uint256 _auctionDuration,
    uint256 _auctionOrderCancellationDuration
) external onlyRole(UPDATE_AUCTION_ROLE) {}
```

#### Parameters

| Name                                | Type    | Description                                              |
| :---------------------------------- | :------ | :------------------------------------------------------- |
| `_auctionDuration`                  | uint256 | Duration of auction in unixtimestamp.                    |
| `_auctionOrderCancellationDuration` | uint256 | Duration of auction order cancellation in unixtimestamp. |

## Errors

### SubjectFactory_InvalidBeneficiary

The contract will emit the error if the beneficiary address is not valid.

```js
error SubjectFactory_InvalidBeneficiary();
```

### SubjectFactory_InvalidFeePercentage

The contract will emit the error if the fee percentage is not valid.

```js
error SubjectFactory_InvalidFeePercentage();
```

### SubjectFactory_InvalidSubject

The contract will emit the error if the subject address is not valid.

```js
error SubjectFactory_InvalidSubject();
```

### SubjectFactory_InvalidTokenManager

The contract will emit the error if the token manager address is not valid.

```js
error SubjectFactory_InvalidTokenManager();
```

### SubjectFactory_InvalidMoxieBondingCurve

The contract will emit the error if the moxie bonding curve address is not valid.

```js
error SubjectFactory_InvalidMoxieBondingCurve();
```

### SubjectFactory_InvalidToken

The contract will emit the error if the token address is not valid.

```js
error SubjectFactory_InvalidToken();
```

### SubjectFactory_InvalidAuctionDuration

The contract will emit the error if the auction duration is not valid.

```js
error SubjectFactory_InvalidAuctionDuration();
```

### SubjectFactory_InvalidAuctionOrderCancellationDuration

The contract will emit the error if the auction order cancellation duration is not valid.

```js
error SubjectFactory_InvalidAuctionOrderCancellationDuration();
```

### SubjectFactory_InvalidAuctionContract

The contract will emit the error if the auction contract is not valid.

```js
error SubjectFactory_InvalidAuctionContract();
```

### SubjectFactory_AuctionAlreadyCreated

The contract will emit the error if the auction is already created.

```js
error SubjectFactory_AuctionAlreadyCreated();
```

### SubjectFactory_AuctionNotCreated

The contract will emit the error if the auction is not created.

```js
error SubjectFactory_AuctionNotCreated();
```

### SubjectFactory_AuctionNotDoneYet

The contract will emit the error if the auction is not done yet.

```js
error SubjectFactory_AuctionNotDoneYet();
```

### SubjectFactory_InvalidOwner

The contract will emit the error if the owner address is not valid.

```js
error SubjectFactory_InvalidOwner();
```

### SubjectFactory_InvalidReserveRatio

The contract will emit the error if the reserve ratio is not valid.

```js
error SubjectFactory_InvalidReserveRatio();
```

### SubjectFactory_BuyAmountTooLess

The contract will emit the error if the buy amount is too less.

```js
error SubjectFactory_BuyAmountTooLess();
```
