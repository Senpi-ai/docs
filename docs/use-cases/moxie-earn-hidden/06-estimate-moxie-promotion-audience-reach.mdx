import Prerequisites from "../../../src/components/Tutorials/Prerequisites";
import DeveloperSupport from "../../../partial/_developer_support.mdx";
import Header from "../../../src/components/Tutorials/Header";
import AddQuery from "../../../src/components/Tutorials/AddQuery";
import ExecuteCode from "../../../src/components/Tutorials/ExecuteCode";
import url from "../../../constant/api_url.json";
import CodeBlock from "@theme/CodeBlock";
import Install from "../../../src/components/Install";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Estimate Moxie Promotion Audience Reach

<Header
  useCase="estimate the audience reach of a certain Moxie Earn promotion based on the rules set by the promoter"
  apiName="Moxie Partner"
/>

# Pre-requisites

1. Install dependencies `graphql`and`graphql-request` to your project :

<Install dependencies="graphql graphql-request" />

2. Your will need a special API key to access to the Moxie Partner API. To request access, please fill in this form [here](https://forms.gle/eRQ6uiCzica2J6qo8).

## Step 1: Add The API Query To Your Code

<AddQuery
  useCase="estimate the audience reach of a certain Moxie Earn promotion based on the rules set by the promoter"
  subgraphLink="https://api.moxie.xyz/protocol/graphql"
  query={`query($operatorType: PromotionRuleOperatorType!, $promotionRules: [PromotionRuleInput!]) {
  EstimateAudienceReach(input: {operatorType: $operatorType, promotionRules: $promotionRules}) {
    audienceReach
    avgFarScore
  }
}`}
  headers={`{
  // Add Airstack API key here
  "x-airstack-protocol": process.env.AIRSTACK_API_KEY as string,
}`}
  variable={`{
  "operatorType": "AND",
  // Set the promotion rules here
  "promotionRules": [
    {
      "ruleType": "FOLLOWED_BY",
      "followedByRuleInput": {
        "operatorType": "TOTAL_GREATER_THAN",
        "value": ["3"], 
      }
    }
  ]
}`}
  response={`{
  "data": {
    "EstimateAudienceReach": {
      // The estimated audience reach
      "audienceReach": 101,
      // The average FarScore of the audience
      "avgFarScore": 14.768068950613701
    }
  }
}`}
/>

## Step 2: Execute Your Code

Once you have your code ready, you can execute it by running the following command:

<Tabs>
  <TabItem value="ts" label="TypeScript">
    <CodeBlock language="sh">{"ts-node index.ts"}</CodeBlock>
  </TabItem>
  <TabItem value="js" label="JavaScript">
    <CodeBlock language="sh">{"node index.js"}</CodeBlock>
  </TabItem>
</Tabs>

If it runs successfully, you should see the data returned in the terminal:

```json
{
  "data": {
    "EstimateAudienceReach": {
      // The estimated audience reach
      "audienceReach": 101,
      // The average FarScore of the audience
      "avgFarScore": 14.768068950613701
    }
  }
}
```

Congrats! ðŸ¥³ðŸŽ‰ You've just successfully get the estimate audience reach of a certain Moxie Promotion based on the promotion rules set!

<DeveloperSupport />
