---
sidebar_class_name: users
description: Learn how to use the Moxie Protocol Subgraph API to get all fan tokens owned by a certain user.
---

import Prerequisites from "../../../src/components/Tutorials/Prerequisites";
import DeveloperSupport from "../../../partial/_developer_support.mdx";
import Install from "../../../src/components/Install";
import Header from "../../../src/components/Tutorials/Header";
import AddQuery from "../../../src/components/Tutorials/AddQuery";
import ExecuteCode from "../../../src/components/Tutorials/ExecuteCode";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import url from "../../../constant/api_url.json";

# Get All Fan Tokens Owned By Certain User

In this tutorial, you will learn how to get all the fan tokens owned by a certain user by calling the [Moxie Protocol Subgraph API](../../api/protocol/01-overview.mdx).

# Pre-requisites

1. Install dependencies `graphql`and`graphql-request` to your project :

<Install dependencies="graphql graphql-request" />

2. For profile resolution from FID to addresses, you will either [download moxie_resolve.json](/farcaster-data/guides/download-data) file or use a third-service API provider, such as [Airstack](https://airstack.xyz). If you are using Airstack, you can install the Airstack Node SDK:

<Install dependencies="@airstack/node" />

## Step 1: Resolve User's FID to Addresses

A user can hold their [Fan tokens](../../learn/glossary.mdx#fan-token) in either their Farcaster verified wallet or their vesting contract address (a.k.a. airdrop wallet).

Thus, the first step is to resolve the user's FID to their Farcaster verified wallet and vesting contract wallet. To do so, you have 2 options:

**Using [moxie_resolve.json](/farcaster-data/guides/download-data)**

To use [moxie_resolve.json](/farcaster-data/guides/download-data), simply [download](/farcaster-data/guides/download-data) the file and add the following utility function to your code:

<Tabs>
  <TabItem value="ts" label="TypeScript">

```ts title="utils/resolve.ts"
import data from "./moxie_resolve.json";

const resolveFidToAddresses = (fid: number) => {
  return data?.filter((d) => d?.fid === fid)?.map((d) => d?.address);
};

export default resolveFidToAddresses;
```

  </TabItem>
  <TabItem value="js" label="JavaScript">

```js title="utils/resolve.js"
const data = require("./moxie_resolve.json");

const resolveFidToAddresses = (fid) => {
  return data?.filter((d) => d?.fid === fid)?.map((d) => d?.address);
};

module.exports = resolveFidToAddresses;
```

  </TabItem>
</Tabs>

To resolve, simply call the function and provide the user's FID as input. In return, you will get an array of the user's Farcaster verified wallet and vesting contract wallet addresses that can be used in [Step 2](#step-2-add-the-api-query-to-your-code).

**Using subgraph and third-party APIs**

## Step 2: Add The API Query To Your Code

To get all the fan tokens owned by a certain user, you can use the following query on the [Moxie Protocol Subgraph API](../../api/protocol/01-overview.mdx) and provide the array of addresses resolved in [Step 1](#step-1-resolve-users-fid-to-addresses) as input:

<Tabs>
  <TabItem value="query" label="Query">

```graphql
query MyQuery($userAddresses: [ID!]) {
  users(where: { id_in: $userAddresses }) {
    portfolio {
      balance
      buyVolume
      sellVolume
      subjectToken {
        name
        symbol
      }
    }
  }
}
```

  </TabItem>
  <TabItem value="variable" label="Variable">

```json
{
  "userAddresses": ["0x00d620def6ccb76c92dbfc87bc2bebab7637ec53"]
}
```

  </TabItem>
  <TabItem value="response" label="Response">

```json
{
  "data": {
    "users": [
      {
        "portfolio": [
          {
            "balance": "442691639238050376",
            "buyVolume": "0",
            "sellVolume": "0",
            "subjectToken": {
              "name": "sarvesh371",
              "symbol": "fid:11536"
            }
          }
        ]
      }
    ]
  }
}
```

  </TabItem>
</Tabs>

With this GraphQL query, you can add it to your source code and call the API with the `graphql-request` library:

<Tabs>
        <TabItem value="ts" label="TypeScript">

```ts title="index.ts"
import { gql, GraphQLClient } from "graphql-request";
import resolveFidToAddresses from "./utils/resolve";

// Add you FID here
const fid = 3;

const graphQLClient = new GraphQLClient(
  "https://api.studio.thegraph.com/query/23537/moxie_protocol_stats_mainnet/version/latest"
);

const query = gql`
  query MyQuery($userAddresses: [ID!]) {
    users(where: { id_in: $userAddresses }) {
      portfolio {
        balance
        buyVolume
        sellVolume
        subjectToken {
          name
          symbol
        }
      }
    }
  }
`;

const variable = {
  // You can remove await if you are using `moxie_resolve.json`
  userAddresses: await resolveFidToAddresses(fid),
};

try {
  const data = await graphQLClient.request(query, variable);
  console.log(data);
} catch (e) {
  throw new Error(e);
}
```

      </TabItem>
      <TabItem value="js" label="JavaScript">

```js title="index.js"
const { gql, GraphQLClient } = require("graphql-request");
const resolveFidToAddresses = require("./utils/resolve");

// Add you FID here
const fid = 3;

const graphQLClient = new GraphQLClient(
  "https://api.studio.thegraph.com/query/23537/moxie_protocol_stats_mainnet/version/latest"
);

const query = gql`
  query MyQuery($userAddresses: [ID!]) {
    users(where: { id_in: $userAddresses }) {
      portfolio {
        balance
        buyVolume
        sellVolume
        subjectToken {
          name
          symbol
        }
      }
    }
  }
`;

const variable = {
  // You can remove await if you are using `moxie_resolve.json`
  userAddresses: await resolveFidToAddresses(fid),
};

try {
  const data = await graphQLClient.request(query, variable);
  console.log(data);
} catch (e) {
  throw new Error(e);
}
```

    </TabItem>

</Tabs>

## Step 3: Execute Your Code

<ExecuteCode
  response={`{
  "data": {
    "users": [
      {
        "portfolio": [
          {
            "balance": "442691639238050376",
            "buyVolume": "0",
            "sellVolume": "0",
            "subjectToken": {
              "name": "sarvesh371",
              "symbol": "fid:11536"
            }
          }
        ]
      }
    ]
  }
}`}
  dataFetched="all fan tokens owned by a certain user"
/>

<DeveloperSupport />
